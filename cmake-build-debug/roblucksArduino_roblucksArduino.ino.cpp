// automatically generated by arduino-cmake
#line 1 "/home/james/Roblucks/roblucksArduino/roblucksArduino.ino"
#include <Arduino.h>
#include <stdint.h>

#include "Motor/Motor.h"
#include "SerialIO/SerialIO.h"
#include "Message.h"
#include "parameters.h"
#include "RoblucksServo/RoblucksServo.h"

#line 12 "/home/james/Roblucks/roblucksArduino/cmake-build-debug/roblucksArduino_roblucksArduino.ino.cpp"
#include "Arduino.h"

//=== START Forward: /home/james/Roblucks/roblucksArduino/roblucksArduino.ino
 bool getMessageFromServer();
 bool getMessageFromServer();
 void setup() ;
 void setup() ;
 void loop() ;
 void loop() ;
//=== END Forward: /home/james/Roblucks/roblucksArduino/roblucksArduino.ino
#line 8 "/home/james/Roblucks/roblucksArduino/roblucksArduino.ino"


Motor motor;
SerialIO serialIO;
RoblucksServo servo;

bool isConnected = false;

bool getMessageFromServer(){
    if(Serial.available()) {
        Message msgRecevied = serialIO.readMessage();

        switch(msgRecevied){
            case MOTOR: {
                motor.processRequest();
                break;
            }
            case SERVO:{
                servo.processRequest();
                break;
            }
            case HELLO: {
                isConnected = true;
                serialIO.writeMessage(ALREADY_CONNECTED);
                break;
            }
            case ALREADY_CONNECTED: {
                isConnected = true;
                serialIO.writeMessage(ALREADY_CONNECTED);
                break;
            }
            default: {
                serialIO.writeMessage(STRING);
                Serial.write("Default Message\n");
                return false;
            }
        }
    }
    return false;
}

void setup() {
    Serial.begin(SERIAL_BAUD);

    while(!isConnected)
    {
        serialIO.writeMessage(HELLO);
        serialIO.wait_for_bytes(1, 1000);
        getMessageFromServer();
    }

}

void loop() {
    getMessageFromServer();
}

